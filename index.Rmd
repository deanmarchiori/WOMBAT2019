---
title: "Pearls and pitfalls of time series analysis"
subtitle: "using Google Analytics data"
author: "WOMBAT 2019"
output:
  xaringan::moon_reader:
    lib_dir: libs
    nature:
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
editor_options: 
  chunk_output_type: console
---


```{css eval=FALSE, include=FALSE}
pre {
  max-width: 100%;
  overflow-x: scroll;
}
.left-code {
  color: #777;
  width: 38%;
  height: 92%;
  float: left;
  font-size: 70% 
}
.right-plot {
  width: 60%;
  float: right;
  padding-left: 1%;
}
.remark-code { font-family: 'Source Code Pro', 'Lucida Console', Monaco, monospace;
                                    font-size: 70%;
}
.inverse {
  background-color: #132734;
  color: #d6d6d6;
  text-shadow: 0 0 20px #333;
}
.title-slide {
  background-color: #132734;
  color: #d6d6d6;
  text-shadow: 0 0 20px #333;
  class: inverse, center, middle;
  background-image: url('img/logo.png');  
  background-position: 5% 98%;  
  background-size: 150px ;
}


```

class: center  

# Dean Marchiori  
deanmarchiori.github.io  

```{r echo=FALSE}
knitr::include_graphics('img/dean.jpg', dpi = 600)
```

---

Clinical pearls are " small bits of free standing, clinically relevant information. " (Lorin MI, 2008)

Lorin, Martin & Palazzi, Debra & Turner, Teri & Ward, Mark. (2008). What is a clinical pearl and what is its role in medical education?. Medical teacher. 30. 870-4. 10.1080/01421590802144286. 

---

# Industrial data analysis  

* Productive  
* Efficient  
* Effective 

> Profitable  


---
class: inverse, center, middle  

# Perfect is the enemy of good

---

# Everything you need to know  
# The least you need to know


---


# analyst being compentent  

# tools being well designed  

---

# What is Google Analytics?   

* web analytics service  
* free (to a point)  
* awesome for basic reports    

```{r echo=FALSE}
knitr::include_graphics('img/ga.png')
```


---

# What is it not?   
* advanced analytics / modelling platform  
* extensible   
* simple  

```{r echo=FALSE}
knitr::include_graphics('img/ga2.png')
```


---

# What is BigQuery   

* Google cloud based data warehouse solution  
* Get a full export daily of all sessions and hits  
* query in a SQL like syntax  
* (Users of Analytics 360 only)


```{r echo=FALSE}
knitr::include_graphics('img/bq-1.png')
```

```{r echo=FALSE}
knitr::include_graphics('img/bq-2.png')
```

---

# How GA thinks about data   

## Dimensions  

--

The attributes of your data  

--

## Metrics  

--

The quantitative measurements  

---

# example  

page | sessions 
--|---
/ | 526  
/aboutme | 251  
/contact | 230  

--

`page` : is the dimension  
`sessions`: is the metric  

---

# time series example    


|date       | sessions|
|:----------|--------:|
|2019-07-01 |        1|
|2019-07-02 |       17|
|2019-07-03 |        2|
|2019-07-04 |        4|
|2019-07-05 |        0|
|2019-07-06 |        0|
|2019-07-07 |        1|
|2019-07-08 |        1|
|2019-07-09 |        3|
|2019-07-10 |        2|
|2019-07-11 |        0|
|2019-07-12 |        3|


---

# Going nuts

|date       |browser           |browserversion   | sessions| bouncerate|
|:----------|:-----------------|:----------------|--------:|----------:|
|2019-07-01 |Chrome            |75.0.3770.100    |        1|    0.00000|
|2019-07-02 |'Mozilla          |5.0              |       16|  100.00000|
|2019-07-02 |Chrome            |72.0.3626.109    |        1|    0.00000|
|2019-07-03 |Chrome            |72.0.3626.109    |        1|    0.00000|
|2019-07-03 |Chrome            |75.0.3770.100    |        1|    0.00000|
|2019-07-04 |Chrome            |75.0.3770.100    |        3|   33.33333|
|2019-07-04 |Safari            |13.0             |        1|  100.00000|
|2019-07-07 |Opera             |52.4.2517.140781 |        1|  100.00000|
|2019-07-08 |Chrome            |75.0.3770.100    |        1|  100.00000|
|2019-07-09 |Chrome            |72.0.3626.109    |        1|    0.00000|
|2019-07-09 |Chrome            |73.0.3683.88     |        1|  100.00000|
|2019-07-09 |Chrome            |75.0.3770.100    |        1|  100.00000|
|2019-07-10 |Chrome            |75.0.3770.100    |        1|    0.00000|
|2019-07-10 |Firefox           |67.0             |        1|  100.00000|
|2019-07-12 |Chrome            |75.0.3770.100    |        1|  100.00000|
|2019-07-12 |Chrome            |75.0.3770.101    |        1|  100.00000|

---
class: inverse, center, middle

# Yeah, but how do I get it out?  

---

# API    

```{r echo=FALSE}
knitr::include_graphics('img/api.png')
```

source: https://developers.google.com/analytics  

---

# API    

```{r echo=FALSE}
knitr::include_graphics('img/api2.png')
```

source: https://developers.google.com/analytics  


---

# Use Standard SQL

There are two dialects:  

* Standard SQL  
* Legacy SQL

```{sql eval=FALSE, include=TRUE}
#standardSQL #<<
SELECT  date, 
        totals.visits, 
        totals.pageviews 

FROM `bigquery-public-data.google_analytics_sample.ga_sessions_20170801`
```


---

# Learn Arrays and STRUCTS    

Array: Ordered list of zero or more elements of any non-ARRAY type.   
STRUCT:  Container of ordered fields each with a type  


```{sql eval=FALSE, include=TRUE}
SELECT [1, 2, 3] AS numbers; 
```

---  

---
# Structured / Relational Database  


```{r echo=FALSE}
knitr::include_graphics('img/rdb.png')
```


---
# Semi-Structured / Denormalised 

```{r echo=FALSE}
knitr::include_graphics('img/ssdb.png', dpi = 100)
```

---

# Example  

```{sql eval=FALSE, include=TRUE}
#standardSQL
SELECT  'Gin and Tonic' AS drink,
        ['Gin', 'Tonic'] AS ingredients
  UNION ALL
SELECT  'Martini' AS drink,
        ['Gin', 'Dry Vermouth'] AS ingredients
  UNION ALL
SELECT  'Manhattan' AS drink,
        ['Rye Whiskey', 'Sweet Vermouth', 'Angostura bitters'] AS ingredients
```

```{r echo=FALSE}
knitr::include_graphics('img/eg1.png', dpi = 100)
```

---

# Example  

```{sql eval=FALSE, include=TRUE}
SELECT drink FROM cocktails
```

```{r echo=FALSE}
knitr::include_graphics('img/eg2.png', dpi = 100)
```

---

# Example  

```{sql eval=FALSE, include=TRUE}
SELECT  drink, 
        flat_ingredients
FROM cocktails
  CROSS JOIN UNNEST(cocktails.ingredients) as flat_ingredients #<<
```

```{r echo=FALSE}
knitr::include_graphics('img/eg3.png', dpi = 100)
```

---

# Learn about table suffix  


---
class: inverse, center, middle

# Yeah, but how do I get it out???  


---

# Use `googleAnalyticsR`    

Maintained by Mark Edmondson  

- Well maintained  
- Well documented  
- Loads of useful functions  

Notable Mentions:  
* rga  
* RGoogleAnalytics  
* ganalytics  
* GAR  



---

# Time series example   

```{r eval=FALSE, include=TRUE}
library(googleAnalyticsR)

my_ga <- google_analytics(viewId = 184371396, 
                          date_range = c('2019-01-01', '2019-02-01'), 
                          dimensions = "date",
                          metrics = "sessions", 
                          max = -1)

```


---

# Dials and Knobs  


---

# Sampling & Limits  


---

# Time zones and DST  


---

# Modelling Functions  


---
class: inverse, center, middle

# Don't-skip-resources  

---

# Sample Dataset  

https://support.google.com/analytics/answer/7586738?hl=en  


```{r echo=FALSE}
knitr::include_graphics('img/sample.png')
```

---

# Big Query Cookbook  

https://support.google.com/analytics/answer/4419694?hl=en&ref_topic=3416089


---

# Export Schema  

https://support.google.com/analytics/answer/3437719?hl=en&ref_topic=3416089

---

# Query Explorer

https://ga-dev-tools.appspot.com/query-explorer/

```{r echo=FALSE}
knitr::include_graphics('img/queryexplorer.png', dpi = 200)
```

---

# Dimensions and Metrics Explorer

https://ga-dev-tools.appspot.com/dimensions-metrics-explorer/

```{r echo=FALSE}
knitr::include_graphics('img/dimmtricexpl.png', dpi = 200)
```












